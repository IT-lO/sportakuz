<!DOCTYPE html>
<!-- Bazowy plik fragmentÃ³w Thymeleaf.
     Fragment 'base(pageTitle,content)' wspÃ³lny ukÅ‚ad: nagÅ‚Ã³wek, nawigacja, gÅ‚Ã³wna sekcja i stopka.
     UÅ¼ywa Tailwind CDN do stylizacji. -->
<html xmlns:th="http://www.thymeleaf.org" lang="pl" th:fragment="base(pageTitle,content)" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<!-- Sekcja <head>: meta + tytuÅ‚ dynamiczny + konfiguracja Tailwind + gÅ‚Ã³wny arkusz stylÃ³w -->
<head>
    <script>
        (function () {
            try {
                var stored = localStorage.getItem('theme'); // np. 'dark' / 'light'
                var systemPrefersDark = window.matchMedia &&
                    window.matchMedia('(prefers-color-scheme: dark)').matches;

                if (stored === 'dark' || (!stored && systemPrefersDark)) {
                    document.documentElement.classList.add('dark');
                }
            } catch (e) {
                // w razie czego nic nie robimy
            }
        })();
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title th:text="${pageTitle}">SportakUZ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: '#0d6efd'
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" th:href="@{/css/main.css}" />
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex flex-col">
<!-- Header: logo + oznaczenie panelu + gÅ‚Ã³wna nawigacja -->
<header class="bg-white/90 backdrop-blur border-b border-gray-200 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">

        <div class="flex items-center gap-3">
            <span class="text-xl font-bold text-gray-800">SportakUZ</span>
            <span sec:authorize="isAuthenticated()"
                  class="text-xs uppercase tracking-wider text-blue-600 bg-blue-50 px-2 py-1 rounded">
                Panel
            </span>
        </div>

        <nav class="flex items-center gap-4 text-sm">

            <a th:href="@{/}" class="px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition">
                Start
            </a>

            <div sec:authorize="isAuthenticated()" class="flex items-center gap-4">

                <a sec:authorize="hasRole('ADMIN')" th:href="@{/panel/admin}"
                   class="px-3 py-2 rounded-md font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 transition">
                    Panel Admina
                </a>

                <a sec:authorize="hasRole('INSTRUCTOR')" th:href="@{/panel/instructor}"
                   class="px-3 py-2 rounded-md font-medium text-purple-700 bg-purple-50 hover:bg-purple-100 transition">
                    Panel Instruktora
                </a>

                <a sec:authorize="hasRole('USER')" th:href="@{/panel/user}"
                   class="px-3 py-2 rounded-md font-medium text-green-700 bg-green-50 hover:bg-green-100 transition">
                    MÃ³j Panel
                </a>

                <span class="hidden sm:block text-gray-500 font-semibold border-l pl-4 border-gray-300"
                      sec:authentication="name">
                    User
                </span>

                <form th:action="@{/logout}" method="post" class="m-0">
                    <button type="submit" class="px-3 py-2 rounded-md font-semibold bg-red-100 text-red-700 hover:bg-red-200 transition">
                        Wyloguj
                    </button>
                </form>
            </div>

            <div sec:authorize="isAnonymous()">
                <a th:href="@{/login}" class="px-4 py-2 rounded-md font-semibold bg-indigo-600 text-white hover:bg-indigo-700 transition shadow">
                    Zaloguj siÄ™
                </a>
            </div>

        </nav>
    </div>
</header>
<!-- Main: miejsce wstawienia wÅ‚aÅ›ciwej zawartoÅ›ci przy pomocy th:insert(${content}) -->
<main class="flex-1 w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" th:insert="${content}"></main>
<!-- Footer: prosty podpis + rok; utrzymuje layout w dole dziÄ™ki flex-col (mt-auto) -->
<footer class="border-t border-gray-200 bg-white/70 backdrop-blur mt-auto">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-center text-xs text-gray-500">&copy; 2025 SportakUZ</div>
</footer>

<!-- Skrypt motywu (light/dark) â€“ korzysta z html.dark w app.css -->
<script>
    function applyTheme(theme) {
        const root = document.documentElement;

        if (theme === 'dark') {
            root.classList.add('dark');
        } else {
            root.classList.remove('dark');
        }

        localStorage.setItem('theme', theme);

        const icon1 = document.getElementById('theme-icon');
        const icon2 = document.getElementById('theme-icon-layout');
        if (icon1) icon1.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        if (icon2) icon2.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
    }

    function toggleTheme() {
        const isDark = document.documentElement.classList.contains('dark');
        applyTheme(isDark ? 'light' : 'dark');
    }

    document.addEventListener('DOMContentLoaded', () => {
        const saved = localStorage.getItem('theme');

        if (saved === 'dark' || saved === 'light') {
            applyTheme(saved);
        } else {
            // domyÅ›lnie jasny
            applyTheme('light');
        }
    });
</script>

<script>document.documentElement.classList.add('tailwind-loaded');</script>
</body>
</html>

<!-- Dodatkowe alternatywne fragmenty:
     'head(pageTitle)' â€“ sam nagÅ‚Ã³wek dokumentu z meta / tytuÅ‚em.
     'layout(pageTitle,content)' â€“ peÅ‚ny ukÅ‚ad (podobny do 'base'), opcja do uÅ¼ycia przez th:replace. -->
<head th:fragment="head(pageTitle)">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title th:text="${pageTitle}">SportakUZ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: '#0d6efd'
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" th:href="@{/css/app.css}" />
</head>

<body th:fragment="layout(pageTitle,content)" class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex flex-col">
<!-- Layout header (alternatywny) -->
<header class="bg-white/90 backdrop-blur border-b border-gray-200 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <span class="text-xl font-bold text-gray-800">SportakUZ</span>
            <span class="text-xs uppercase tracking-wider text-blue-600 bg-blue-50 px-2 py-1 rounded">Panel</span>
        </div>
        <nav class="flex gap-2 text-sm items-center">
            <a th:href="@{/}" class="px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition">Start</a>
            <a th:href="@{/calendar}" class="px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition">Kalendarz</a>
            <a th:href="@{/my/bookings}" class="px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition">Moje rezerwacje</a>
            <a th:href="@{/activities}" class="px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition">Lista zajÄ™Ä‡</a>
            <a th:href="@{/activities/new}" class="px-3 py-2 rounded-md font-semibold bg-blue-600 text-white hover:bg-blue-700 shadow-sm transition">+ Nowe</a>

            <!-- Przycisk trybu ciemnego w layoucie -->
            <button type="button"
                    class="ml-3 px-3 py-2 rounded-md font-medium border border-gray-300 text-gray-700 bg-white/70 hover:bg-gray-100 transition"
                    onclick="toggleTheme()">
                <span id="theme-icon-layout">ðŸŒ™</span>
            </button>
        </nav>
    </div>
</header>
<!-- Layout main slot -->
<main class="flex-1 w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8" th:insert="${content}"></main>
<!-- Layout footer -->
<footer class="border-t border-gray-200 bg-white/70 backdrop-blur mt-auto">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-center text-xs text-gray-500">&copy; 2025 SportakUZ</div>
</footer>

<!-- Ten sam skrypt motywu, aby dziaÅ‚aÅ‚o takÅ¼e przy uÅ¼yciu fragmentu layout -->
<script>
    function applyTheme(theme) {
        const root = document.documentElement;

        if (theme === 'dark') {
            root.classList.add('dark');
        } else {
            root.classList.remove('dark');
        }

        localStorage.setItem('theme', theme);

        const icon1 = document.getElementById('theme-icon');
        const icon2 = document.getElementById('theme-icon-layout');
        if (icon1) icon1.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        if (icon2) icon2.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
    }

    function toggleTheme() {
        const isDark = document.documentElement.classList.contains('dark');
        applyTheme(isDark ? 'light' : 'dark');
    }

    document.addEventListener('DOMContentLoaded', () => {
        const saved = localStorage.getItem('theme');

        if (saved === 'dark' || saved === 'light') {
            applyTheme(saved);
        } else {
            applyTheme('light');
        }
    });
</script>

<script>document.documentElement.classList.add('tailwind-loaded');</script>
</body>
