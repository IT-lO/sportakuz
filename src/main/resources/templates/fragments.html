<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="pl"
      th:fragment="base(pageTitle,content)">

<head>
    <script>
        (function () {
            try {
                var stored = localStorage.getItem('theme');
                var systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (stored === 'dark' || (!stored && systemPrefersDark)) {
                    document.documentElement.classList.add('dark');
                }
            } catch (e) {}
        })();
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title th:text="${pageTitle}">SportakUZ</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: '#0d6efd',
                        dark: {
                            bg: '#0f172a',
                            card: '#1e293b',
                            text: '#f8fafc'
                        }
                    }
                }
            }
        }
    </script>

    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <style>
        html.dark body { background-color: #0f172a; color: #f8fafc; background-image: none; }
        html.dark .home-hero { filter: brightness(0.9); }
        html.dark header, html.dark footer { background-color: rgba(30, 41, 59, 0.9); border-color: #334155; }
        html.dark .text-gray-700, html.dark .text-gray-800 { color: #e2e8f0; }
        html.dark .text-gray-500, html.dark .text-gray-600 { color: #94a3b8; }
        html.dark .bg-white\/90 { background-color: rgba(30, 41, 59, 0.9); border-color: #334155; }
        html.dark .bg-white { background-color: #1e293b; border-color: #334155; }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex flex-col transition-colors duration-300">

<header class="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-gray-200 shadow-sm transition-colors duration-300">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex items-center justify-between">

        <div class="flex items-center gap-3">
            <a th:href="@{/}" class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600 hover:opacity-80 transition">
                SportakUZ
            </a>
            <span sec:authorize="isAuthenticated()"
                  class="hidden sm:inline-block text-[10px] uppercase tracking-wider font-bold text-blue-600 bg-blue-100 px-2 py-0.5 rounded-full"
                  th:text="#{nav.status.online}">
                Online
            </span>
        </div>

        <nav class="flex items-center gap-2 sm:gap-4 text-sm">

            <a th:href="@{/}"
               class="hidden md:block px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-100 dark:hover:bg-slate-700 transition"
               th:text="#{nav.home}">
                Start
            </a>

            <th:block sec:authorize="hasAnyRole('USER', 'INSTRUCTOR')">
                <a th:href="@{/calendar}"
                   class="px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-slate-700 transition"
                   th:text="#{nav.schedule}">
                    Grafik
                </a>
                <a th:href="@{/my/bookings}"
                   class="px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-100 dark:text-gray-200 dark:hover:bg-slate-700 transition"
                   th:text="#{nav.my_bookings}">
                    Moje rezerwacje
                </a>
            </th:block>

            <div class="flex items-center gap-2">

                <button type="button"
                        onclick="toggleTheme()"
                        class="group flex h-10 w-10 items-center justify-center rounded-full bg-white shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 transition focus:outline-none dark:bg-slate-800 dark:ring-slate-700 dark:hover:bg-slate-700"
                        th:title="#{nav.theme.toggle}"
                        title="PrzeÅ‚Ä…cz motyw">
                    <span id="theme-icon" class="text-xl text-gray-500 group-hover:text-gray-900 dark:text-gray-400 dark:group-hover:text-white transition">ðŸŒ™</span>
                </button>

                <a th:href="@{''(lang=${#locale.language == 'pl' ? 'en' : 'pl'})}"
                   class="group flex h-10 w-10 items-center justify-center rounded-full bg-white shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 transition focus:outline-none no-underline dark:bg-slate-800 dark:ring-slate-700 dark:hover:bg-slate-700"
                   th:title="#{nav.lang.toggle}"
                   title="PrzeÅ‚Ä…cz jÄ™zyk">

                    <span class="text-xl" th:text="${#locale.language == 'pl' ? 'ðŸ‡¬ðŸ‡§' : 'ðŸ‡µðŸ‡±'}">ðŸ‡¬ðŸ‡§</span>
                </a>

            </div>

            <div sec:authorize="isAuthenticated()" class="flex items-center gap-3 ml-2">

                <a sec:authorize="hasRole('ADMIN')" th:href="@{/panel/admin}"
                   class="px-4 py-2 rounded-md font-semibold text-white bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 shadow-md transition transform hover:scale-105"
                   th:text="#{nav.panel}">
                    Panel
                </a>

                <a sec:authorize="hasRole('INSTRUCTOR')" th:href="@{/panel/instructor}"
                   class="hidden sm:inline-block px-4 py-2 rounded-md font-semibold text-white bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-700 hover:to-purple-600 shadow-md transition transform hover:scale-105"
                   th:text="#{nav.panel}">
                    Panel
                </a>

                <a sec:authorize="hasRole('USER')" th:href="@{/panel/user}"
                   class="hidden sm:inline-block px-4 py-2 rounded-md font-semibold text-white bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 shadow-md transition transform hover:scale-105"
                   th:text="#{nav.panel}">
                    Panel
                </a>

                <div class="hidden md:flex flex-col items-end leading-tight border-l pl-3 border-gray-300 dark:border-gray-600 ml-1">
                    <span class="text-xs text-gray-500 dark:text-gray-400" th:text="#{nav.welcome}">Witaj</span>
                    <span class="font-bold text-gray-800 dark:text-gray-200 max-w-[100px] truncate" sec:authentication="name">User</span>
                </div>

                <form th:action="@{/logout}" method="post" class="m-0">
                    <button type="submit"
                            class="p-2 text-gray-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-full transition"
                            th:title="#{nav.logout}"
                            title="Wyloguj siÄ™">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
                        </svg>
                    </button>
                </form>
            </div>

            <div sec:authorize="isAnonymous()" class="flex items-center gap-2">
                <a th:href="@{/login}"
                   class="px-4 py-2 rounded-md font-semibold text-white bg-indigo-600 hover:bg-indigo-700 shadow-md transition"
                   th:text="#{nav.login}">
                    Logowanie
                </a>
                <a th:href="@{/login}" class="sm:hidden p-2 text-indigo-600 bg-indigo-50 rounded-md">
                    ðŸ”‘
                </a>
                <a th:href="@{/register}"
                   class="px-4 py-2 rounded-md font-semibold text-white bg-indigo-600 hover:bg-indigo-700 shadow-md transition"
                   th:text="#{nav.register}">
                    DoÅ‚Ä…cz
                </a>
            </div>

        </nav>
    </div>
</header>

<main class="flex-1 w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 transition-opacity duration-500" th:insert="${content}">
</main>

<footer class="border-t border-gray-200 bg-white/70 backdrop-blur mt-auto dark:border-gray-700 transition-colors duration-300">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex flex-col md:flex-row justify-between items-center text-xs text-gray-500 dark:text-gray-400">
        <div>
            &copy; 2025 SportakUZ. <span th:text="#{footer.rights}">Wszystkie prawa zastrzeÅ¼one.</span>
        </div>
        <div class="flex gap-4 mt-2 md:mt-0">
            <a href="#" class="hover:text-blue-600 transition" th:text="#{footer.terms}">Regulamin</a>
            <a href="#" class="hover:text-blue-600 transition" th:text="#{footer.privacy}">Polityka PrywatnoÅ›ci</a>
            <a href="#" class="hover:text-blue-600 transition" th:text="#{footer.contact}">Kontakt</a>
        </div>
    </div>
</footer>

</body>
</footer>

<script>
    function applyTheme(theme) {
        const root = document.documentElement;
        const icon = document.getElementById('theme-icon');

        if (theme === 'dark') {
            root.classList.add('dark');
            if(icon) icon.textContent = 'â˜€ï¸';
        } else {
            root.classList.remove('dark');
            if(icon) icon.textContent = 'ðŸŒ™';
        }
        localStorage.setItem('theme', theme);
    }

    function toggleTheme() {
        const isDark = document.documentElement.classList.contains('dark');
        applyTheme(isDark ? 'light' : 'dark');
    }
    function toggleLanguage() {
        const flagElement = document.getElementById('current-lang-flag');
        const currentLang = flagElement.getAttribute('data-lang') || 'pl';

        const newLang = currentLang === 'pl' ? 'en' : 'pl';

        const urlParams = new URLSearchParams(window.location.search);

        urlParams.set('lang', newLang);

        window.location.search = urlParams.toString();
    }
    document.addEventListener('DOMContentLoaded', () => {
        const saved = localStorage.getItem('theme');
        if (saved) {
            applyTheme(saved);
        } else {
            const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            applyTheme(systemDark ? 'dark' : 'light');
        }
    });
</script>

<script>document.documentElement.classList.add('tailwind-loaded');</script>
</body>
</html>